<dataTemplate name="TSP_SUMMARY" description="TSP SUMMARY">
 <parameters>
  <parameter name="P_GL_USER" dataType="character" defaultValue="DBA.ADMIN" /> 
  <parameter name="P_ROLE_ID" dataType="character" defaultValue="ADMIN" /> 
  <parameter name="SERVPROV_ID" dataType="character" /> 
  <parameter name="P_YEAR" dataType="character" /> 
		
  </parameters>
  <lexicals /> 
 <dataQuery>
  <sqlStatement name="Q_RC_SUMMARY">
 <![CDATA[ 
	select * from 

(
SELECT coalesce(nvl(TO_CHAR(RC_DATA.END_TIME,'MM/YYYY'),'YTD'),'') AS																				SH_END_TIME,
		coalesce(RC_DATA.SERVPROV,'')	AS																																SERVPROV,
COUNT(DISTINCT RC_DATA.SH_ID) AS 																															OR_COUNT,

/* COUNT(CASE WHEN RC_DATA.HAS_RC='Y' THEN RC_DATA.HAS_RC END) AS 																								OR_WITH_RC_COUNT, */
COUNT(RC_DATA.OTC)+COUNT(RC_DATA.OTD)+COUNT(RC_DATA.PC)+COUNT(RC_DATA.PD)+COUNT(RC_DATA.TP)+COUNT(RC_DATA.DS_CMR_NO_TIME)+COUNT(RC_DATA.SQ)       			OR_WITH_RC_COUNT,
		



TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(
COUNT(RC_DATA.OTC)+COUNT(RC_DATA.OTD)+COUNT(RC_DATA.PC)+COUNT(RC_DATA.PD)+COUNT(RC_DATA.TP)+COUNT(RC_DATA.DS_CMR_NO_TIME)+COUNT(RC_DATA.SQ)
)

)/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 		TOTAL_PERC,

TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(RC_DATA.OTC)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 		OTC,

TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(RC_DATA.OTCI)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 		Collection_OTI,

TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(RC_DATA.OTD)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 		OTD,

TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(RC_DATA.OTDI)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 		Delivery_OTI,


TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(RC_DATA.PC)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 		PC,

TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(RC_DATA.PD)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 		PD,

TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(RC_DATA.TP)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 		TP,

TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(RC_DATA.DS_CMR_NO_TIME)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 		DS_CMR_NO_TIME,

TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(RC_DATA.SQ)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 		SQ


FROM
(
SELECT DISTINCT SH.SHIPMENT_GID	AS																																	SH_ID,
		SH.END_TIME	AS																																		END_TIME,
		/* shs.STOP_NUM as																																		stop_num, */
		(select loc.location_name
		from location loc
		where	loc.location_gid = SH.SERVPROV_GID
		) AS 																																				SERVPROV,
		/* SSUL.ORDER_RELEASE_GID AS																															OR_ID, */
		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID in ('ULE/PR.LCNN','ULE/PR.0002')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				/* and shs.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
				
		) AS 																																				OTC,
		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID in ('ULE/PR.0002')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				/* and shs.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
				
		) AS 																																				OTCI,
		
		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID 
				)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID in ('ULE/PR.0006','ULE/PR.LDNN')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				/* and shs.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
		) AS 																																				OTD,
		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID 
				)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID in ('ULE/PR.0006')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				/* and shs.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
		) AS 																																				OTDI,
		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)
				LEFT OUTER JOIN  SHIPMENT_STOP SS_RC ON (SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM = SS_RC.STOP_NUM )
				
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID IN ('ULE/PR.0017','ULE/PR.0018')
				AND SS_RC.STOP_TYPE = 'P'
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				/* and shs.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
		) AS 																																				PC,

		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)
				LEFT OUTER JOIN  SHIPMENT_STOP SS_RC ON (SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM = SS_RC.STOP_NUM )
				
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID IN ('ULE/PR.0017','ULE/PR.0019')
				AND SS_RC.STOP_TYPE = 'D'
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				/* and shs.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
		) AS 																																				PD,

		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)
				
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID IN ('ULE/PR.0040','ULE/PR.0041','ULE/PR.0042','ULE/PR.0043','ULE/PR.0044')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				/* and shs.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
		) AS 																																				TP,

		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)
				
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID IN ('ULE/PR.0021')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				/* and shs.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
		) AS 																																				DS_CMR_NO_TIME,
		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)
				
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID IN ('ULE/PR.0039')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				/* and shs.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
		) AS 																																				SQ,
		
		(SELECT CASE WHEN MAX(IESH_EVENT_DELIVER.INSERT_DATE) IS NOT NULL THEN 'Y' ELSE 'N' END
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID 
				)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID IN ('ULE/PR.0002','ULE/PR.0006','ULE/PR.0017','ULE/PR.0018','ULE/PR.0019','ULE/PR.0040','ULE/PR.0041',
				'ULE/PR.0042','ULE/PR.0043','ULE/PR.0044','ULE/PR.0021','ULE/PR.0039','ULE/PR.LCNN','ULE/PR.LDNN')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				/* and shs.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
		) AS 																																				HAS_RC

FROM SHIPMENT SH
	/* shipment_stop shs */
/* 	SHIPMENT_S_EQUIPMENT_JOIN SSEJ,
	S_EQUIPMENT_S_SHIP_UNIT_JOIN SESSUJ,
	S_SHIP_UNIT_LINE SSUL */

WHERE 1=1

/* 	AND	SH.SHIPMENT_GID = SSEJ.SHIPMENT_GID 
	AND SSEJ.S_EQUIPMENT_GID = SESSUJ.S_EQUIPMENT_GID 
	AND SESSUJ.S_SHIP_UNIT_GID = SSUL.S_SHIP_UNIT_GID 
	AND SSUL.ORDER_RELEASE_GID IS NOT NULL */
	/* and shs.shipment_gid = sh.shipment_gid */
	
	/* AND	SH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID */
	/* AND	SH.SHIPMENT_GID = 'ULE/PR.2013061580339_0369' */
	/* AND	SH.SERVPROV_GID = 'ULE.T9471' */
	AND	SH.SERVPROV_GID = :SERVPROV_ID
	/* AND SH.SERVPROV_GID = 'ULE.T9471' */
	/* and	TO_CHAR(SH.END_TIME,'YYYY') = to_char(sysdate,'YYYY') */
	and	TO_CHAR(SH.END_TIME,'YYYY') = :P_YEAR
	and TO_CHAR(SH.END_TIME,'MM') <
	case when to_char(sysdate,'YYYY')<> :P_YEAR then '13'
	/* case when to_char(sysdate,'YYYY')<> '2014' then '13' */
	else TO_CHAR(SYSDATE,'MM')
	end
	/* AND TO_CHAR(SH.END_TIME,'MM') < TO_CHAR(SYSDATE,'MM') */
/* 	AND	SH.SERVPROV_GID = 'ULE.T9811725' */
	/* AND (SH.SOURCE_LOCATION_GID NOT IN ('ULE.V50360873','ULE.V50413833','ULE.V50413835','ULE.V50413836','ULE.X207480','ULE.V50413837') OR 
			SH.DEST_LOCATION_GID NOT IN ('ULE.V50360873','ULE.V50413833','ULE.V50413835','ULE.V50413836','ULE.X207480','ULE.V50413837')) */
	AND NOT EXISTS(SELECT 1
	FROM SHIPMENT_REFNUM
	WHERE SHIPMENT_GID = SH.SHIPMENT_GID
	AND SHIPMENT_REFNUM_QUAL_GID = 'ULE.ULE_SHIPMENT_STREAM'
	AND SHIPMENT_REFNUM_VALUE = 'SECONDARY')
	
	/* AND SH.END_TIME BETWEEN TRUNC(SYSDATE-62) AND  TRUNC(LAST_DAY(SYSDATE-31)+1)-0.00027778 */
)																																								RC_DATA



	GROUP BY rollup (RC_DATA.SERVPROV,TO_CHAR(RC_DATA.END_TIME,'MM/YYYY'))



order by 1,2
) temp2
where temp2.SERVPROV is not null

 ]]> 
  </sqlStatement> 
  
  <sqlStatement name="Q_LANE_PERF_OTC">
 <![CDATA[ 
	SELECT * FROM 
(SELECT RC_DATA.CONSIGNOR_CITY	AS																															CONSIGNOR_CITY,
		/* RC_DATA.SOURCE_LOC AS																													SOURCE_LOC, */
		RC_DATA.CONSIGNOR_COUNTRY AS 																														CONSIGNOR_COUNTRY,
		/* RC_DATA.DEST_LOC AS																														DEST_LOC, */
		RC_DATA.CONSIGNEE_CITY AS 																															CONSIGNEE_CITY,
		RC_DATA.CONSIGNEE_COUNTRY AS 																														CONSIGNEE_COUNTRY,
		
		RC_DATA.SERVPROV AS 																																SERVPROV,
COUNT(DISTINCT RC_DATA.SH_ID) AS 																															OR_COUNT,


COUNT(distinct CASE WHEN RC_DATA.HAS_RC='Y' THEN RC_DATA.sh_id END) AS 																								OR_WITH_RC_COUNT,
		
		



TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(DISTINCT CASE WHEN RC_DATA.HAS_RC='Y' THEN RC_DATA.SH_ID END)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 				OTC_PERC,
TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(RC_DATA.OTCI)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 				Collection_OTI

FROM
(
SELECT DISTINCT SH.SHIPMENT_GID	AS																															SH_ID,
		SH.END_TIME	AS																																		END_TIME,
		SS.STOP_NUM as																																		stop_num,
		SH.SERVPROV_GID AS 																																	SERVPROV,
		/* ORLS.ORDER_RELEASE_GID AS																															OR_ID, */
		sh.SOURCE_LOCATION_GID AS																															SOURCE_LOC,
		sh.DEST_LOCATION_GID AS																															DEST_LOC,
		SOURCE_L.CITY AS CONSIGNOR_CITY, 
		SOURCE_L.COUNTRY_CODE3_GID AS CONSIGNOR_COUNTRY,
		DEST_L.CITY AS CONSIGNEE_CITY, 
		DEST_L.COUNTRY_CODE3_GID AS CONSIGNEE_COUNTRY,
/* 		IESH_EVENT_DELIVER.RESPONSIBLE_PARTY_GID AS EVENT_PARTY,
		SSSH_EVENT_DELIVER.REPORTING_GLUSER AS EVENT_REPORTING_USER,
		
		IESH_EVENT_DELIVER.STATUS_CODE_GID AS ENEVT_ID, */
		/* BSSC_EVENT_DELIVER.DESCRIPTION AS EVENT_DESCRIPTION, */
		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID 
				)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID in ('ULE/PR.0002','ULE/PR.LCNN')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				and SS.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM
		) AS 																																				OTC,
		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID in ('ULE/PR.0002')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				and SS.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM
				
		) AS 																																				OTCI,
		
/* 		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID)
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID 
				)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID = 'ULE/PR.0006'
		) AS 																																				OTD, */
	
		(SELECT CASE WHEN MAX(IESH_EVENT_DELIVER.INSERT_DATE) IS NOT NULL THEN 'Y' ELSE 'N' END
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID IN ('ULE/PR.0002','ULE/PR.LCNN')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				/* and SS.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
		) AS 																																				HAS_RC
		
		

FROM SHIPMENT SH,
	SHIPMENT_STOP SS,
	-- SHIPMENT_STOP_D SSD,
	-- S_SHIP_UNIT SSU,
	-- S_SHIP_UNIT_LINE SSUL,
	-- ORDER_RELEASE ORLS,
	LOCATION SOURCE_L,
	LOCATION DEST_L

WHERE 1=1

	AND	SS.SHIPMENT_GID = SH.SHIPMENT_GID
	-- AND SSD.SHIPMENT_GID = SS.SHIPMENT_GID
	-- AND SSD.STOP_NUM = SS.STOP_NUM
	-- AND SSD.S_SHIP_UNIT_GID = SSU.S_SHIP_UNIT_GID
	-- AND SSU.S_SHIP_UNIT_GID = SSUL.S_SHIP_UNIT_GID
	-- AND SSUL.ORDER_RELEASE_GID = ORLS.ORDER_RELEASE_GID
	
	AND	SOURCE_L.LOCATION_GID = sh.SOURCE_LOCATION_GID
	AND	DEST_L.LOCATION_GID = sh.DEST_LOCATION_GID
	
	/* AND	SH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID */
	/* AND	SH.SHIPMENT_GID = 'ULE/PR.2013061580339_0369' */
	/* AND	SH.SERVPROV_GID = 'ULE.'||'T9811725' */
	AND	SH.SERVPROV_GID = :SERVPROV_ID
	and	TO_CHAR(SH.END_TIME,'YYYY') = :P_YEAR
	and TO_CHAR(SH.END_TIME,'MM') <
	case when to_char(sysdate,'YYYY')<>:P_YEAR then '13'
	else TO_CHAR(SYSDATE,'MM')
	end
	
	AND NOT EXISTS(SELECT 1
	FROM SHIPMENT_REFNUM
	WHERE SHIPMENT_GID = SH.SHIPMENT_GID
	AND SHIPMENT_REFNUM_QUAL_GID = 'ULE.ULE_SHIPMENT_STREAM'
	AND SHIPMENT_REFNUM_VALUE = 'SECONDARY')
	
	/* AND (SH.SOURCE_LOCATION_GID NOT IN ('ULE.V50360873','ULE.V50413833','ULE.V50413835','ULE.V50413836','ULE.X207480','ULE.V50413837') OR 
			SH.DEST_LOCATION_GID NOT IN ('ULE.V50360873','ULE.V50413833','ULE.V50413835','ULE.V50413836','ULE.X207480','ULE.V50413837')) */
	
	/* AND SH.END_TIME BETWEEN TRUNC(SYSDATE-62) AND  TRUNC(LAST_DAY(SYSDATE-31)+1)-0.00027778 */
)																																								RC_DATA

/* WHERE 


RANK() OVER (PARTITION BY SERVPROV ORDER BY ((COUNT(DISTINCT RC_DATA.OR_ID)-(COUNT(CASE WHEN RC_DATA.HAS_RC='Y' THEN RC_DATA.HAS_RC END)))/
COUNT(DISTINCT RC_DATA.OR_ID))*100) <11 */

GROUP BY RC_DATA.SERVPROV,
/* 		RC_DATA.SOURCE_LOC,
		RC_DATA.DEST_LOC, */
		RC_DATA.CONSIGNOR_CITY,
		RC_DATA.CONSIGNOR_COUNTRY,
		RC_DATA.CONSIGNEE_CITY,
		RC_DATA.CONSIGNEE_COUNTRY
ORDER BY OR_WITH_RC_COUNT DESC
)
WHERE ROWNUM<21

	
	
 ]]> 
 </sqlStatement> 
  
 <sqlStatement name="Q_LANE_PERF_OTD">
<![CDATA[ 
	SELECT * FROM 
(select 
		/* RC_data.source_loc as																													source_loc, */
		RC_data.CONSIGnor_CITY	as	CONSIGnor_CITY,
		RC_data.CONSIGnor_COUNTRY as CONSIGnor_COUNTRY,
		/* RC_data.dest_loc as																														dest_loc, */
		RC_data.CONSIGNEE_CITY as CONSIGNEE_CITY,
		RC_data.CONSIGNEE_COUNTRY as CONSIGNEE_COUNTRY,
		
		
		RC_data.servprov	AS																													SERVPROV,
count(distinct RC_data.sh_id) as 																												OR_count,


COUNT(distinct CASE WHEN RC_data.HAS_RC='Y' THEN RC_data.sh_id END) AS 																					OR_WITH_RC_COUNT,
		
		



to_char(((count(distinct RC_data.sh_id)-(COUNT(DISTINCT CASE WHEN RC_DATA.HAS_RC='Y' THEN RC_DATA.SH_ID END)))/
count(distinct RC_data.sh_id))*100,'9990.99')||'%' 																							as 		OTD_PERC,
TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(RC_DATA.OTDI)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 		Delivery_OTI

from
(
select distinct sh.shipment_gid	as																															sh_id,
		sh.end_time	as																																		end_time,
		SS.STOP_NUM as																																		stop_num,
		sh.servprov_gid as 																																	servprov,
		/* orls.ORDER_RELEASE_GID as																															or_id, */
		sh.source_location_gid as																															source_loc,
		sh.dest_location_gid as																															dest_loc,
		source_l.CITY AS CONSIGnor_CITY, 
		source_l.COUNTRY_CODE3_GID AS CONSIGnor_COUNTRY,
		dest_l.CITY AS CONSIGNEE_CITY, 
		dest_l.COUNTRY_CODE3_GID AS CONSIGNEE_COUNTRY,
/* 		IESH_EVENT_DELIVER.RESPONSIBLE_PARTY_GID as Event_Party,
		SSSH_EVENT_DELIVER.REPORTING_GLUSER as Event_Reporting_User,
		
		IESH_EVENT_DELIVER.STATUS_CODE_GID as enevt_id, */
		/* BSSC_EVENT_DELIVER.DESCRIPTION as Event_Description, */
/* 		(select MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		from 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID)
				LEFT OUTER JOIN  BS_REASON_CODE bsrc ON (bsrc.BS_REASON_CODE_gid = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID 
				)
		where 1=1
				 and	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				and bsrc.BS_REASON_CODE_gid = 'ULE/PR.0002'
		) as 																																				OTC, */
		
		(select MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		from 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE bsrc ON (bsrc.BS_REASON_CODE_gid = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)
		where 1=1
				 and	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				and bsrc.BS_REASON_CODE_gid in ('ULE/PR.0006','ULE/PR.LDNN')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				and SS.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM
		) as 																																				OTD,
		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID 
				)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID in ('ULE/PR.0006')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				and SS.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM
		) AS 																																				OTDI,
	
		(select CASE WHEN MAX(IESH_EVENT_DELIVER.INSERT_DATE) IS NOT NULL THEN 'Y' ELSE 'N' END
		from 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE bsrc ON (bsrc.BS_REASON_CODE_gid = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID 
				)
		where 1=1
				 and	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				and bsrc.BS_REASON_CODE_gid IN ('ULE/PR.0006','ULE/PR.LDNN')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				/* and SS.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
		) as 																																				HAS_RC
		
		

from shipment sh,
	SHIPMENT_STOP SS,
	-- SHIPMENT_STOP_D SSD,
	-- S_SHIP_UNIT SSU,
	-- S_SHIP_UNIT_LINE SSUL,
	-- ORDER_RELEASE ORLS,
	location source_l,
	location dest_l

where 1=1

	AND	SS.SHIPMENT_GID = SH.SHIPMENT_GID
	-- AND SSD.SHIPMENT_GID = SS.SHIPMENT_GID
	-- AND SSD.STOP_NUM = SS.STOP_NUM
	-- AND SSD.S_SHIP_UNIT_GID = SSU.S_SHIP_UNIT_GID
	-- AND SSU.S_SHIP_UNIT_GID = SSUL.S_SHIP_UNIT_GID
	-- AND SSUL.ORDER_RELEASE_GID = ORLS.ORDER_RELEASE_GID
	
	and	source_l.location_gid = sh.source_location_gid
	and	dest_l.location_gid = sh.dest_location_gid
	
	/* AND	SH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID */
	/* AND	SH.SHIPMENT_GID = 'ULE/PR.2013061580339_0369' */
	/* AND	SH.SERVPROV_GID = 'ULE.'||'T9811725' */
	AND	SH.SERVPROV_GID = :SERVPROV_ID
	and	TO_CHAR(SH.END_TIME,'YYYY') = :P_YEAR
	and TO_CHAR(SH.END_TIME,'MM') <
	case when to_char(sysdate,'YYYY')<>:P_YEAR then '13'
	else TO_CHAR(SYSDATE,'MM')
	end
	
	AND NOT EXISTS(SELECT 1
	FROM SHIPMENT_REFNUM
	WHERE SHIPMENT_GID = SH.SHIPMENT_GID
	AND SHIPMENT_REFNUM_QUAL_GID = 'ULE.ULE_SHIPMENT_STREAM'
	AND SHIPMENT_REFNUM_VALUE = 'SECONDARY')
	
	/* and sh.end_time BETWEEN trunc(sysdate-62) AND  TRUNC(LAST_DAY(SYSDATE-31)+1)-0.00027778 */
	/* AND (SH.SOURCE_LOCATION_GID NOT IN ('ULE.V50360873','ULE.V50413833','ULE.V50413835','ULE.V50413836','ULE.X207480','ULE.V50413837') OR 
			SH.DEST_LOCATION_GID NOT IN ('ULE.V50360873','ULE.V50413833','ULE.V50413835','ULE.V50413836','ULE.X207480','ULE.V50413837')) */
)																																								RC_data


group by RC_data.servprov,
/* 		RC_data.source_loc,
		RC_data.dest_loc, */
		RC_data.CONSIGnor_CITY,
		RC_data.CONSIGnor_COUNTRY,
		RC_data.CONSIGNEE_CITY,
		RC_data.CONSIGNEE_COUNTRY
ORDER BY OR_WITH_RC_COUNT DESC
)
WHERE ROWNUM<21
	
]]> 
 </sqlStatement> 
 
 

 <sqlStatement name="Q_LANE_PERF_OTC_MONTH">
 <![CDATA[ 
SELECT * FROM 
(SELECT RC_DATA.CONSIGNOR_CITY	AS																															CONSIGNOR_CITY,
		/* RC_DATA.SOURCE_LOC AS																													SOURCE_LOC, */
		RC_DATA.CONSIGNOR_COUNTRY AS 																														CONSIGNOR_COUNTRY,
		/* RC_DATA.DEST_LOC AS																														DEST_LOC, */
		RC_DATA.CONSIGNEE_CITY AS 																															CONSIGNEE_CITY,
		RC_DATA.CONSIGNEE_COUNTRY AS 																														CONSIGNEE_COUNTRY,
		
		RC_DATA.SERVPROV AS 																																SERVPROV,
COUNT(DISTINCT RC_DATA.sh_id) AS 																															OR_COUNT,


COUNT(distinct CASE WHEN RC_DATA.HAS_RC='Y' THEN RC_DATA.sh_id END) AS 																								OR_WITH_RC_COUNT,
		
		



TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(DISTINCT CASE WHEN RC_DATA.HAS_RC='Y' THEN RC_DATA.SH_ID END)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 				OTC_PERC,
TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(RC_DATA.OTCI)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 		Collection_OTI

FROM
(
SELECT DISTINCT SH.SHIPMENT_GID	AS																															SH_ID,
		SH.END_TIME	AS																																		END_TIME,
		SS.STOP_NUM as																																		stop_num,
		SH.SERVPROV_GID AS 																																	SERVPROV,
		-- ORLS.ORDER_RELEASE_GID AS																															OR_ID,
		ORLS.SOURCE_LOCATION_GID AS																															SOURCE_LOC,
		ORLS.DEST_LOCATION_GID AS																															DEST_LOC,
		SOURCE_L.CITY AS CONSIGNOR_CITY, 
		SOURCE_L.COUNTRY_CODE3_GID AS CONSIGNOR_COUNTRY,
		DEST_L.CITY AS CONSIGNEE_CITY, 
		DEST_L.COUNTRY_CODE3_GID AS CONSIGNEE_COUNTRY,
/* 		IESH_EVENT_DELIVER.RESPONSIBLE_PARTY_GID AS EVENT_PARTY,
		SSSH_EVENT_DELIVER.REPORTING_GLUSER AS EVENT_REPORTING_USER,
		
		IESH_EVENT_DELIVER.STATUS_CODE_GID AS ENEVT_ID, */
		/* BSSC_EVENT_DELIVER.DESCRIPTION AS EVENT_DESCRIPTION, */
		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID 
				)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID in ('ULE/PR.0002','ULE/PR.LCNN')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				and SS.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM
		) AS 																																				OTC,
		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID in ('ULE/PR.0002')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				and SS.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM
				
		) AS 																																				OTCI,
		
/* 		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID)
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID 
				)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID = 'ULE/PR.0006'
		) AS 																																				OTD, */
	
		(SELECT CASE WHEN MAX(IESH_EVENT_DELIVER.INSERT_DATE) IS NOT NULL THEN 'Y' ELSE 'N' END
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID IN ('ULE/PR.0002','ULE/PR.LCNN')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				and SS.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM
		) AS 																																				HAS_RC
		
		

FROM SHIPMENT SH,
	SHIPMENT_STOP SS,
	SHIPMENT_STOP_D SSD,
	S_SHIP_UNIT SSU,
	S_SHIP_UNIT_LINE SSUL,
	ORDER_RELEASE ORLS,
	LOCATION SOURCE_L,
	LOCATION DEST_L

WHERE 1=1

	AND	SS.SHIPMENT_GID = SH.SHIPMENT_GID
	AND SSD.SHIPMENT_GID = SS.SHIPMENT_GID
	AND SSD.STOP_NUM = SS.STOP_NUM
	AND SSD.S_SHIP_UNIT_GID = SSU.S_SHIP_UNIT_GID
	AND SSU.S_SHIP_UNIT_GID = SSUL.S_SHIP_UNIT_GID
	AND SSUL.ORDER_RELEASE_GID = ORLS.ORDER_RELEASE_GID
	
	AND	SOURCE_L.LOCATION_GID = ORLS.SOURCE_LOCATION_GID
	AND	DEST_L.LOCATION_GID = ORLS.DEST_LOCATION_GID
	
	/* AND	SH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID */
	/* AND	SH.SHIPMENT_GID = 'ULE/PR.2013061580339_0369' */
	/* AND	SH.SERVPROV_GID = 'ULE.'||'T9811725' */
	AND	SH.SERVPROV_GID = :SERVPROV_ID
	
	and	TO_CHAR(SH.END_TIME,'YYYY') = :P_YEAR
	/* to_char(sysdate,'YYYY') */
	
	and TO_CHAR(SH.END_TIME,'MM') =
	case when to_char(sysdate,'YYYY') = :P_YEAR then TO_CHAR(TRUNC(TRUNC(SYSDATE,'MM')-1,'MM'),'MM')
	else '12'
	end
	
	
	
	AND NOT EXISTS(SELECT 1
	FROM SHIPMENT_REFNUM
	WHERE SHIPMENT_GID = SH.SHIPMENT_GID
	AND SHIPMENT_REFNUM_QUAL_GID = 'ULE.ULE_SHIPMENT_STREAM'
	AND SHIPMENT_REFNUM_VALUE = 'SECONDARY')
	
	/* AND SH.END_TIME BETWEEN TRUNC(SYSDATE-62) AND  TRUNC(LAST_DAY(SYSDATE-31)+1)-0.00027778 */
	/* AND (SH.SOURCE_LOCATION_GID NOT IN ('ULE.V50360873','ULE.V50413833','ULE.V50413835','ULE.V50413836','ULE.X207480','ULE.V50413837') OR 
			SH.DEST_LOCATION_GID NOT IN ('ULE.V50360873','ULE.V50413833','ULE.V50413835','ULE.V50413836','ULE.X207480','ULE.V50413837')) */
)																																								RC_DATA

/* WHERE 


RANK() OVER (PARTITION BY SERVPROV ORDER BY ((COUNT(DISTINCT RC_DATA.OR_ID)-(COUNT(CASE WHEN RC_DATA.HAS_RC='Y' THEN RC_DATA.HAS_RC END)))/
COUNT(DISTINCT RC_DATA.OR_ID))*100) <11 */

GROUP BY RC_DATA.SERVPROV,
/* 		RC_DATA.SOURCE_LOC,
		RC_DATA.DEST_LOC, */
		RC_DATA.CONSIGNOR_CITY,
		RC_DATA.CONSIGNOR_COUNTRY,
		RC_DATA.CONSIGNEE_CITY,
		RC_DATA.CONSIGNEE_COUNTRY
ORDER BY OR_WITH_RC_COUNT DESC
)
WHERE ROWNUM<21

	
	
 ]]> 
 </sqlStatement> 
  
 <sqlStatement name="Q_LANE_PERF_OTD_MONTH">
<![CDATA[ 
SELECT * FROM 
(select 
		/* RC_data.source_loc as																													source_loc, */
		RC_data.CONSIGnor_CITY	as	CONSIGnor_CITY,
		RC_data.CONSIGnor_COUNTRY as CONSIGnor_COUNTRY,
		/* RC_data.dest_loc as																														dest_loc, */
		RC_data.CONSIGNEE_CITY as CONSIGNEE_CITY,
		RC_data.CONSIGNEE_COUNTRY as CONSIGNEE_COUNTRY,
		
		
		RC_data.servprov	AS																													SERVPROV,
count(distinct RC_data.sh_id) as 																												OR_count,


COUNT(distinct CASE WHEN RC_data.HAS_RC='Y' THEN RC_data.sh_id END) AS 																					OR_WITH_RC_COUNT,
		
		



to_char(((count(distinct RC_data.sh_id)-(COUNT(DISTINCT CASE WHEN RC_DATA.HAS_RC='Y' THEN RC_DATA.SH_ID END)))/
count(distinct RC_data.sh_id))*100,'9990.99')||'%' 																							as 		OTD_PERC,
TO_CHAR(((COUNT(DISTINCT RC_DATA.SH_ID)-(COUNT(RC_DATA.OTDI)))/
COUNT(DISTINCT RC_DATA.SH_ID))*100,'9990.99')||'%' 																							AS 		Delivery_OTI

from
(
select distinct sh.shipment_gid	as																															sh_id,
		sh.end_time	as																																		end_time,
		SS.STOP_NUM as																																		stop_num,
		sh.servprov_gid as 																																	servprov,
		/* orls.ORDER_RELEASE_GID as																															or_id, */
		sh.source_location_gid as																															source_loc,
		sh.dest_location_gid as																															dest_loc,
		source_l.CITY AS CONSIGnor_CITY, 
		source_l.COUNTRY_CODE3_GID AS CONSIGnor_COUNTRY,
		dest_l.CITY AS CONSIGNEE_CITY, 
		dest_l.COUNTRY_CODE3_GID AS CONSIGNEE_COUNTRY,
/* 		IESH_EVENT_DELIVER.RESPONSIBLE_PARTY_GID as Event_Party,
		SSSH_EVENT_DELIVER.REPORTING_GLUSER as Event_Reporting_User,
		
		IESH_EVENT_DELIVER.STATUS_CODE_GID as enevt_id, */
		/* BSSC_EVENT_DELIVER.DESCRIPTION as Event_Description, */
/* 		(select MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		from 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID)
				LEFT OUTER JOIN  BS_REASON_CODE bsrc ON (bsrc.BS_REASON_CODE_gid = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID 
				)
		where 1=1
				 and	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				and bsrc.BS_REASON_CODE_gid = 'ULE/PR.0002'
		) as 																																				OTC, */
		
		(select MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		from 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE bsrc ON (bsrc.BS_REASON_CODE_gid = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)
		where 1=1
				 and	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				and bsrc.BS_REASON_CODE_gid in ('ULE/PR.0006','ULE/PR.LDNN')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				and SS.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM
		) as 																																				OTD,
		(SELECT MAX(IESH_EVENT_DELIVER.INSERT_DATE)
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID 
				)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID in ('ULE/PR.0006')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				and SS.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM
		) AS 																																				OTDI,
	
		(select CASE WHEN MAX(IESH_EVENT_DELIVER.INSERT_DATE) IS NOT NULL THEN 'Y' ELSE 'N' END
		from 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE bsrc ON (bsrc.BS_REASON_CODE_gid = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID 
				)
		where 1=1
				 and	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				and bsrc.BS_REASON_CODE_gid IN ('ULE/PR.0006','ULE/PR.LDNN')
				and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null
				/* and SS.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
		) as 																																				HAS_RC
		
		

from shipment sh,
	SHIPMENT_STOP SS,
	-- SHIPMENT_STOP_D SSD,
	-- S_SHIP_UNIT SSU,
	-- S_SHIP_UNIT_LINE SSUL,
	-- ORDER_RELEASE ORLS,
	location source_l,
	location dest_l

where 1=1

 	AND	SS.SHIPMENT_GID = SH.SHIPMENT_GID
	/*AND SSD.SHIPMENT_GID = SS.SHIPMENT_GID
	AND SSD.STOP_NUM = SS.STOP_NUM
	AND SSD.S_SHIP_UNIT_GID = SSU.S_SHIP_UNIT_GID
	AND SSU.S_SHIP_UNIT_GID = SSUL.S_SHIP_UNIT_GID
	AND SSUL.ORDER_RELEASE_GID = ORLS.ORDER_RELEASE_GID */
	
	and	source_l.location_gid = sh.source_location_gid
	and	dest_l.location_gid = sh.dest_location_gid
	
	/* AND	SH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID */
	/* AND	SH.SHIPMENT_GID = 'ULE/PR.2013061580339_0369' */
	/* AND	SH.SERVPROV_GID = 'ULE.'||'T9811725' */
	AND	SH.SERVPROV_GID = :SERVPROV_ID
	and	TO_CHAR(SH.END_TIME,'YYYY') = :P_YEAR
	/* to_char(sysdate,'YYYY') */
	
	and TO_CHAR(SH.END_TIME,'MM') =
	case when to_char(sysdate,'YYYY') = :P_YEAR then TO_CHAR(TRUNC(TRUNC(SYSDATE,'MM')-1,'MM'),'MM')
	else '12'
	end
	
	AND NOT EXISTS(SELECT 1
	FROM SHIPMENT_REFNUM
	WHERE SHIPMENT_GID = SH.SHIPMENT_GID
	AND SHIPMENT_REFNUM_QUAL_GID = 'ULE.ULE_SHIPMENT_STREAM'
	AND SHIPMENT_REFNUM_VALUE = 'SECONDARY')
	
	/* AND (SH.SOURCE_LOCATION_GID NOT IN ('ULE.V50360873','ULE.V50413833','ULE.V50413835','ULE.V50413836','ULE.X207480','ULE.V50413837') OR 
			SH.DEST_LOCATION_GID NOT IN ('ULE.V50360873','ULE.V50413833','ULE.V50413835','ULE.V50413836','ULE.X207480','ULE.V50413837')) */
	
	/* and sh.end_time BETWEEN trunc(sysdate-62) AND  TRUNC(LAST_DAY(SYSDATE-31)+1)-0.00027778 */
)																																								RC_data


group by RC_data.servprov,
/* 		RC_data.source_loc,
		RC_data.dest_loc, */
		RC_data.CONSIGnor_CITY,
		RC_data.CONSIGnor_COUNTRY,
		RC_data.CONSIGNEE_CITY,
		RC_data.CONSIGNEE_COUNTRY
ORDER BY OR_WITH_RC_COUNT DESC
)
WHERE ROWNUM<21
	
]]> 
 </sqlStatement> 
 
  <sqlStatement name="Q_RC_DETAILS">
<![CDATA[ 
SELECT 	TO_CHAR(RC_DATA.END_TIME,'MM') as																													SH_END_MONTH,
		/* RC_DATA.STOP_NUM as																																	STOP_NUM, */
		/* RC_DATA.OR_ID	as																																	OR_ID, */
		RC_DATA.SH_ID AS																																	SH_ID,
		RC_DATA.CONSIGNOR_CITY	AS																															CONSIGNOR_CITY,
		/* RC_DATA.SOURCE_LOC AS																													SOURCE_LOC, */
		RC_DATA.CONSIGNOR_COUNTRY AS 																														CONSIGNOR_COUNTRY,
		/* RC_DATA.DEST_LOC AS																														DEST_LOC, */
		RC_DATA.CONSIGNEE_CITY AS 																															CONSIGNEE_CITY,
		RC_DATA.CONSIGNEE_COUNTRY AS 																														CONSIGNEE_COUNTRY,
		
		/* RC_DATA.SERVPROV AS 																																SERVPROV, */
		RC_DATA.RC_ID AS 																																	RC_ID,
		RC_DATA.RC_DESC AS 																																	RC_DESC,
		RC_DATA.RC_INSERT_USER AS																															RC_INSERT_USER,
		nvl(upper((SELECT LISTAGG(ATT.LANE_ATTRIBUTE_VALUE,'/') WITHIN GROUP (ORDER BY XL.X_LANE_GID)
		FROM RATE_GEO RG,
			X_LANE XL,
			LANE_ATTRIBUTE ATT
		WHERE RG.RATE_GEO_GID = RC_DATA.sh_rg
		AND RG.X_LANE_GID = XL.X_LANE_GID
		AND ATT.X_LANE_GID = XL.X_LANE_GID
		AND ATT.LANE_ATTRIBUTE_DEF_GID ='ULE.ULE_CSS'
		)),'-') AS																																				CSS,
		RC_DATA.REGION AS																																	REGION
/* COUNT(DISTINCT RC_DATA.OR_ID) AS 																															OR_COUNT */


FROM
(
SELECT DISTINCT SH.SHIPMENT_GID	AS																															SH_ID,
			sh.RATE_GEO_GID 																																sh_rg,
		/* orls.order_release_gid as																															OR_ID, */
		SH.END_TIME	AS																																		END_TIME,
		/* SS.STOP_NUM as																																		stop_num, */
		
		(select loc.location_name
		from location loc
		where	loc.location_gid = SH.SERVPROV_GID
		) AS 																																				SERVPROV,
		SH.SOURCE_LOCATION_GID AS																															SOURCE_LOC,
		SH.DEST_LOCATION_GID AS																															DEST_LOC,
		SOURCE_L.CITY AS CONSIGNOR_CITY, 
		SOURCE_L.COUNTRY_CODE3_GID AS CONSIGNOR_COUNTRY,
		DEST_L.CITY AS CONSIGNEE_CITY, 
		DEST_L.COUNTRY_CODE3_GID AS CONSIGNEE_COUNTRY,
		BSRC.BS_REASON_CODE_GID AS RC_ID,
		BSRC.DESCRIPTION AS RC_DESC,
		IESH_EVENT_DELIVER.insert_user as																													RC_INSERT_USER,
		(
		SELECT LISTAGG(SHR_REGION.SHIPMENT_REFNUM_VALUE,'|') WITHIN GROUP (ORDER BY SH_REGION.SHIPMENT_GID)
		FROM SHIPMENT SH_REGION
				LEFT OUTER JOIN SHIPMENT_REFNUM SHR_REGION ON (SH_REGION.SHIPMENT_GID = SHR_REGION.SHIPMENT_GID 
				AND SHR_REGION.SHIPMENT_REFNUM_QUAL_GID = 'ULE.ULE_FUNCTIONAL_REGION')
		WHERE
			/* SH_REGION.DOMAIN_NAME ='ULE/PR' */
				SH_REGION.SHIPMENT_GID = SH.SHIPMENT_GID
		) 	AS 																																			REGION
/* 		IESH_EVENT_DELIVER.RESPONSIBLE_PARTY_GID AS EVENT_PARTY,
		SSSH_EVENT_DELIVER.REPORTING_GLUSER AS EVENT_REPORTING_USER,
		
		IESH_EVENT_DELIVER.STATUS_CODE_GID AS ENEVT_ID, */
		/* BSSC_EVENT_DELIVER.DESCRIPTION AS EVENT_DESCRIPTION, */
		
		
				 
/* 				

	
		(SELECT CASE WHEN MAX(IESH_EVENT_DELIVER.INSERT_DATE) IS NOT NULL THEN 'Y' ELSE 'N' END
		FROM 	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID)
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)
		WHERE 1=1
				 AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
				AND BSRC.BS_REASON_CODE_GID IN ('ULE/PR.0002')
		) AS 																																				HAS_RC */
		
		

FROM SHIPMENT SH,
	/* SHIPMENT_STOP SS,
	SHIPMENT_STOP_D SSD,
	S_SHIP_UNIT SSU,
	S_SHIP_UNIT_LINE SSUL,
	ORDER_RELEASE ORLS, */
	LOCATION SOURCE_L,
	LOCATION DEST_L,
	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO and IESH_EVENT_DELIVER.SS_CONTACT_NAME is null)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)

WHERE 1=1

	/* AND	SS.SHIPMENT_GID = SH.SHIPMENT_GID
	AND SSD.SHIPMENT_GID = SS.SHIPMENT_GID
	AND SSD.STOP_NUM = SS.STOP_NUM
	AND SSD.S_SHIP_UNIT_GID = SSU.S_SHIP_UNIT_GID
	AND SSU.S_SHIP_UNIT_GID = SSUL.S_SHIP_UNIT_GID
	AND SSUL.ORDER_RELEASE_GID = ORLS.ORDER_RELEASE_GID */
	
	AND	SOURCE_L.LOCATION_GID = SH.SOURCE_LOCATION_GID
	AND	DEST_L.LOCATION_GID = SH.DEST_LOCATION_GID
	
	AND	SH.SHIPMENT_TYPE_GID IN ('TRANSPORT')
	
	AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
	AND BSRC.BS_REASON_CODE_GID IN ('ULE/PR.0002','ULE/PR.0006','ULE/PR.0017','ULE/PR.0018','ULE/PR.0019','ULE/PR.0040','ULE/PR.0041',
				'ULE/PR.0042','ULE/PR.0043','ULE/PR.0044','ULE/PR.0021','ULE/PR.0039','ULE/PR.LDNN','ULE/PR.LCNN')
	
	AND IESH_EVENT_DELIVER.INSERT_DATE = (SELECT DISTINCT MAX(IESH_EVENT_DELIVER_TEMP.INSERT_DATE)
        FROM   SS_STATUS_HISTORY SSH_TEMP,
               IE_SHIPMENTSTATUS IESH_EVENT_DELIVER_TEMP
        WHERE  IESH_EVENT_DELIVER_TEMP.STATUS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID
               AND SSH_TEMP.SHIPMENT_GID = SH.SHIPMENT_GID 
			   AND SSH_TEMP.I_TRANSACTION_NO = 
                                 IESH_EVENT_DELIVER_TEMP.I_TRANSACTION_NO)
	/* AND	SH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID */
	/* AND	SH.SHIPMENT_GID = 'ULE/PR.2013061580339_0369' */
	/* AND	SH.SERVPROV_GID = 'ULE.T9471' */
	AND	SH.SERVPROV_GID = :SERVPROV_ID
	and	TO_CHAR(SH.END_TIME,'YYYY') = :P_YEAR
	and TO_CHAR(SH.END_TIME,'MM') <
	case when to_char(sysdate,'YYYY')<>:P_YEAR then '13'
	else TO_CHAR(SYSDATE,'MM')
	end
	/* and sh.shipment_gid ='ULE/PR.100217215' */
	AND NOT EXISTS(SELECT 1
	FROM SHIPMENT_REFNUM
	WHERE SHIPMENT_GID = SH.SHIPMENT_GID
	AND SHIPMENT_REFNUM_QUAL_GID = 'ULE.ULE_SHIPMENT_STREAM'
	AND SHIPMENT_REFNUM_VALUE = 'SECONDARY')
	/* AND (SH.SOURCE_LOCATION_GID NOT IN ('ULE.V50360873','ULE.V50413833','ULE.V50413835','ULE.V50413836','ULE.X207480','ULE.V50413837') OR 
			SH.DEST_LOCATION_GID NOT IN ('ULE.V50360873','ULE.V50413833','ULE.V50413835','ULE.V50413836','ULE.X207480','ULE.V50413837')) */
			/* and SS.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
	/* AND SH.END_TIME BETWEEN TRUNC(SYSDATE-62) AND  TRUNC(LAST_DAY(SYSDATE-31)+1)-0.00027778 */
)																																								RC_DATA


/* GROUP BY 

		RC_DATA.CONSIGNOR_CITY,
		RC_DATA.CONSIGNOR_COUNTRY,
		RC_DATA.CONSIGNEE_CITY,
		RC_DATA.CONSIGNEE_COUNTRY,
		RC_DATA.RC_ID,
		RC_DATA.RC_DESC,
		RC_DATA.OR_ID,
		RC_DATA.SH_ID,
		TO_CHAR(RC_DATA.END_TIME,'MM'),
		RC_DATA.RC_INSERT_USER,
		RC_DATA.REGION */

ORDER BY 	SH_END_MONTH


	
	
]]> 
 </sqlStatement> 
 
   <sqlStatement name="Q_RC_FLEXIBILITY">
<![CDATA[
SELECT TO_CHAR(RC_DATA.END_TIME,'MM') AS																											SH_END_MONTH,
		RC_DATA.SH_ID																																SH_ID,
		/* RC_DATA.OR_ID AS																															OR_ID, */
		RC_DATA.CONSIGNOR_CITY	AS																													CONSIGNOR_CITY,
		/* RC_DATA.SOURCE_LOC AS																													SOURCE_LOC, */
		RC_DATA.CONSIGNOR_COUNTRY AS 																												CONSIGNOR_COUNTRY,
		/* RC_DATA.DEST_LOC AS																														DEST_LOC, */
		RC_DATA.CONSIGNEE_CITY AS 																													CONSIGNEE_CITY,
		RC_DATA.CONSIGNEE_COUNTRY AS 																												CONSIGNEE_COUNTRY,
		
		/* RC_DATA.SERVPROV, */
		RC_DATA.RC_ID AS 																															RC_ID,
		RC_DATA.RC_DESC AS 																															RC_DESC
		/* COUNT(DISTINCT RC_DATA.OR_ID) AS 																															OR_COUNT */


FROM
(
SELECT DISTINCT SH.SHIPMENT_GID	AS																															SH_ID,
		SH.END_TIME	AS																																		END_TIME,
		/* SS.STOP_NUM as																																		stop_num, */
		SH.SERVPROV_GID AS 																																	SERVPROV,
		/* ORLS.ORDER_RELEASE_GID AS																															OR_ID, */
		SH.SOURCE_LOCATION_GID AS																															SOURCE_LOC,
		SH.DEST_LOCATION_GID AS																															DEST_LOC,
		SOURCE_L.CITY AS CONSIGNOR_CITY, 
		SOURCE_L.COUNTRY_CODE3_GID AS CONSIGNOR_COUNTRY,
		DEST_L.CITY AS CONSIGNEE_CITY, 
		DEST_L.COUNTRY_CODE3_GID AS CONSIGNEE_COUNTRY,
		BSRC.BS_REASON_CODE_GID AS RC_ID,
		BSRC.DESCRIPTION AS RC_DESC

FROM SHIPMENT SH,
	/* SHIPMENT_STOP SS,
	SHIPMENT_STOP_D SSD,
	S_SHIP_UNIT SSU,
	S_SHIP_UNIT_LINE SSUL,
	ORDER_RELEASE ORLS, */
	LOCATION SOURCE_L,
	LOCATION DEST_L,
	SS_STATUS_HISTORY SSSH_EVENT_DELIVER
				LEFT OUTER JOIN IE_SHIPMENTSTATUS IESH_EVENT_DELIVER ON (SSSH_EVENT_DELIVER.I_TRANSACTION_NO = IESH_EVENT_DELIVER.I_TRANSACTION_NO)
				/* LEFT OUTER JOIN BS_STATUS_CODE BSSC_EVENT_DELIVER ON (IESH_EVENT_DELIVER.STATUS_CODE_GID = BSSC_EVENT_DELIVER.BS_STATUS_CODE_GID) */
				LEFT OUTER JOIN  BS_REASON_CODE BSRC ON (BSRC.BS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID)

WHERE 1=1

/* 	AND	SS.SHIPMENT_GID = SH.SHIPMENT_GID
	AND SSD.SHIPMENT_GID = SS.SHIPMENT_GID
	AND SSD.STOP_NUM = SS.STOP_NUM
	AND SSD.S_SHIP_UNIT_GID = SSU.S_SHIP_UNIT_GID
	AND SSU.S_SHIP_UNIT_GID = SSUL.S_SHIP_UNIT_GID
	AND SSUL.ORDER_RELEASE_GID = ORLS.ORDER_RELEASE_GID */
	
	AND	SOURCE_L.LOCATION_GID = SH.SOURCE_LOCATION_GID
	AND	DEST_L.LOCATION_GID = SH.DEST_LOCATION_GID
	
	AND	SSSH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID
	AND BSRC.BS_REASON_CODE_GID IN ('ULE/PR.0020')
	
	/* AND	SH_EVENT_DELIVER.SHIPMENT_GID = SH.SHIPMENT_GID */
	/* AND	SH.SHIPMENT_GID = 'ULE/PR.2013061a580339_0369' */
	/* AND	SH.SERVPROV_GID = 'ULE.'||'T9811725' */
	AND	SH.SERVPROV_GID = :SERVPROV_ID
	and	TO_CHAR(SH.END_TIME,'YYYY') = :P_YEAR
	and TO_CHAR(SH.END_TIME,'MM') <
	case when to_char(sysdate,'YYYY')<>:P_YEAR then '13'
	else TO_CHAR(SYSDATE,'MM')
	end
	/* AND (SH.SOURCE_LOCATION_GID NOT IN ('ULE.V50360873','ULE.V50413833','ULE.V50413835','ULE.V50413836','ULE.X207480','ULE.V50413837') OR 
			SH.DEST_LOCATION_GID NOT IN ('ULE.V50360873','ULE.V50413833','ULE.V50413835','ULE.V50413836','ULE.X207480','ULE.V50413837')) */
			
	AND NOT EXISTS(SELECT 1
	FROM SHIPMENT_REFNUM
	WHERE SHIPMENT_GID = SH.SHIPMENT_GID
	AND SHIPMENT_REFNUM_QUAL_GID = 'ULE.ULE_SHIPMENT_STREAM'
	AND SHIPMENT_REFNUM_VALUE = 'SECONDARY')
	
	AND IESH_EVENT_DELIVER.INSERT_DATE = (SELECT DISTINCT MAX(IESH_EVENT_DELIVER_TEMP.INSERT_DATE)
        FROM   SS_STATUS_HISTORY SSH_TEMP,
               IE_SHIPMENTSTATUS IESH_EVENT_DELIVER_TEMP
        WHERE  IESH_EVENT_DELIVER_TEMP.STATUS_REASON_CODE_GID = IESH_EVENT_DELIVER.STATUS_REASON_CODE_GID
               AND SSH_TEMP.SHIPMENT_GID = SH.SHIPMENT_GID 
			   AND SSH_TEMP.I_TRANSACTION_NO = 
                                 IESH_EVENT_DELIVER_TEMP.I_TRANSACTION_NO)
	
	/* and SS.STOP_NUM = SSSH_EVENT_DELIVER.SHIPMENT_STOP_NUM */
	/* AND SH.END_TIME BETWEEN TRUNC(SYSDATE-62) AND  TRUNC(LAST_DAY(SYSDATE-31)+1)-0.00027778 */
)																																								RC_DATA

WHERE ROWNUM<11

GROUP BY 
		/* RC_DATA.SERVPROV, */
/* 		RC_DATA.SOURCE_LOC,
		RC_DATA.DEST_LOC, */
		RC_DATA.CONSIGNOR_CITY,
		RC_DATA.CONSIGNOR_COUNTRY,
		RC_DATA.CONSIGNEE_CITY,
		RC_DATA.CONSIGNEE_COUNTRY,
		RC_DATA.RC_ID,
		RC_DATA.RC_DESC,
		TO_CHAR(RC_DATA.END_TIME,'MM'),
		/* RC_DATA.OR_ID, */
		RC_DATA.SH_ID

	


	

	 
]]> 
 </sqlStatement> 
 
    <sqlStatement name="Q_RC_DESC">
<![CDATA[ 
(SELECT 'OTC' AS 																															GROUP_NAME,
		'ON TIME COLLECTION' AS																														GROUP_DESC,
		'"'||'0002'||'"' AS																																RC,
		'LATE COLLECTION' AS																														RC_DESC
FROM DUAL
)
UNION ALL
(SELECT 'OTD' AS 																															GROUP_NAME,
		'ON TIME DELIVERY' AS																												GROUP_DESC,
		'"'||'0006'||'"' AS																																RC,
		'LATE DELIVERY' AS																														RC_DESC
FROM DUAL
)
UNION ALL
(SELECT 'PC' AS 																															GROUP_NAME,
		'PROBLEMS ON COLLECTION' AS																												GROUP_DESC,
		'"'||'0017'||'"' AS																																RC,
		'EQUIPMENT REFUSED (INCORRECT EQUIPMENT OR BAD QA)' AS																				RC_DESC
FROM DUAL
)
UNION ALL
(SELECT 'PC' AS 																															GROUP_NAME,
		'PROBLEMS ON COLLECTION' AS																												GROUP_DESC,
		'"'||'0018'||'"' AS																																RC,
		'NO BOOKING FOR LOADING' AS																														RC_DESC
FROM DUAL
)
UNION ALL
(SELECT 'PD' AS 																															GROUP_NAME,
		'PROBLEMS ON DELIVERY' AS																												GROUP_DESC,
		'"'||'0017'||'"' AS																																RC,
		'EQUIPMENT REFUSED (INCORRECT EQUIPMENT OR BAD QA)' AS																				RC_DESC
FROM DUAL
)
UNION ALL
(SELECT 'PD' AS 																															GROUP_NAME,
		'PROBLEMS ON DELIVERY' AS																												GROUP_DESC,
		'"'||'0019'||'"' AS																																RC,
		'NO BOOKING FOR UNLOADING' AS																														RC_DESC
FROM DUAL
)
UNION ALL
(SELECT 'TP' AS 																															GROUP_NAME,
		'TENDER PERFORMANCE' AS																												GROUP_DESC,
		'"'||'0040'||'"' AS																																RC,
		'EQUIPMENT NOT AVAILABLE' AS																														RC_DESC
FROM DUAL
)
UNION ALL
(SELECT 'TP' AS 																															GROUP_NAME,
		'TENDER PERFORMANCE' AS																												GROUP_DESC,
		'"'||'0041'||'"' AS																																RC,
		'CAPACITY TYPE ISSUE' AS																														RC_DESC
FROM DUAL
)
UNION ALL
(SELECT 'TP' AS 																															GROUP_NAME,
		'TENDER PERFORMANCE' AS																												GROUP_DESC,
		'"'||'0042'||'"' AS																																RC,
		'UNABLE TO MEET DELIVERY TIMES' AS																														RC_DESC
FROM DUAL
)
UNION ALL
(SELECT 'TP' AS 																															GROUP_NAME,
		'TENDER PERFORMANCE' AS																												GROUP_DESC,
		'"'||'0043'||'"' AS																																RC,
		'PERMIT ISSUE' AS																														RC_DESC
FROM DUAL
)
UNION ALL
(SELECT 'TP' AS 																															GROUP_NAME,
		'TENDER PERFORMANCE' AS																												GROUP_DESC,
		'"'||'0044'||'"' AS																																RC,
		'WEIGHT RESTRICTION' AS																														RC_DESC
FROM DUAL
)
UNION ALL
(SELECT 'DS_CMR_NO_TIME' AS 																															GROUP_NAME,
		'DOCUMENTS NOT SEND ON TIME' AS																												GROUP_DESC,
		'"'||'0021'||'"' AS																																RC,
		'CMR NOT SENT ON TIME' AS																														RC_DESC
FROM DUAL
)
UNION ALL
(SELECT 'SQ' AS 																															GROUP_NAME,
		'SERVICE QUALITY' AS																												GROUP_DESC,
		'"'||'0039'||'"' AS																																RC,
		'QUALITY' AS																														RC_DESC
FROM DUAL
)
UNION ALL
(SELECT 'LCNN' AS 																															GROUP_NAME,
		'lATE COLLECTION NO NOTIFICATION' AS																												GROUP_DESC,
		'"'||'LCNN'||'"' AS																																RC,
		'LATE COLLECTION' AS																														RC_DESC
FROM DUAL
)
UNION ALL
(SELECT 'LDNN' AS 																															GROUP_NAME,
		'lATE DELIVERY NO NOTIFICATION' AS																												GROUP_DESC,
		'"'||'LDNN'||'"' AS																																RC,
		'LATE DELIVERY' AS																														RC_DESC
FROM DUAL
)

]]> 
 </sqlStatement>
 
 </dataQuery>
 <dataStructure> 
 <group name="G_RC_SUMMARY" dataType="varchar2" source="Q_RC_SUMMARY">
   <element name="SH_END_TIME" dataType="varchar2" value="SH_END_TIME" /> 
   <element name="SERVPROV" dataType="varchar2" value="SERVPROV" /> 
   <element name="OR_COUNT" dataType="varchar2" value="OR_COUNT" /> 
   <element name="OR_WITH_RC_COUNT" dataType="varchar2" value="OR_WITH_RC_COUNT" /> 
   <element name="TOTAL_PERC" dataType="varchar2" value="TOTAL_PERC" /> 
   <element name="OTC" dataType="varchar2" value="OTC" />
   <element name="COLLECTION_OTI" dataType="varchar2" value="COLLECTION_OTI" />    
   <element name="OTD" dataType="varchar2" value="OTD" /> 
   <element name="DELIVERY_OTI" dataType="varchar2" value="DELIVERY_OTI" /> 
   <element name="PC" dataType="varchar2" value="PC" /> 
   <element name="PD" dataType="varchar2" value="PD" /> 
   <element name="TP" dataType="varchar2" value="TP" /> 
   <element name="DS_CMR_NO_TIME" dataType="varchar2" value="DS_CMR_NO_TIME" /> 
   <element name="SQ" dataType="varchar2" value="SQ" /> 

 </group>
 <group name="G_LANE_PERF_OTC" dataType="varchar2" source="Q_LANE_PERF_OTC">
   <element name="CONSIGnor_CITY" dataType="varchar2" value="CONSIGnor_CITY" /> 
   <element name="CONSIGnor_COUNTRY" dataType="varchar2" value="CONSIGnor_COUNTRY" /> 
   <element name="CONSIGNEE_CITY" dataType="varchar2" value="CONSIGNEE_CITY" /> 
   <element name="CONSIGNEE_COUNTRY" dataType="varchar2" value="CONSIGNEE_COUNTRY" /> 
   <element name="SERVPROV" dataType="varchar2" value="SERVPROV" /> 
   <element name="OR_COUNT" dataType="varchar2" value="OR_COUNT" /> 
   <element name="OR_WITH_RC_COUNT" dataType="varchar2" value="OR_WITH_RC_COUNT" /> 
   <element name="OTC_PERC" dataType="varchar2" value="OTC_PERC" /> 
   <element name="COLLECTION_OTI" dataType="varchar2" value="COLLECTION_OTI" /> 

 </group>
 <group name="G_LANE_PERF_OTD" dataType="varchar2" source="Q_LANE_PERF_OTD">
   <element name="CONSIGnor_CITY" dataType="varchar2" value="CONSIGnor_CITY" /> 
   <element name="CONSIGnor_COUNTRY" dataType="varchar2" value="CONSIGnor_COUNTRY" /> 
   <element name="CONSIGNEE_CITY" dataType="varchar2" value="CONSIGNEE_CITY" /> 
   <element name="CONSIGNEE_COUNTRY" dataType="varchar2" value="CONSIGNEE_COUNTRY" /> 
   <element name="SERVPROV" dataType="varchar2" value="SERVPROV" /> 
   <element name="OR_COUNT" dataType="varchar2" value="OR_COUNT" /> 
   <element name="OR_WITH_RC_COUNT" dataType="varchar2" value="OR_WITH_RC_COUNT" /> 
   <element name="OTD_PERC" dataType="varchar2" value="OTD_PERC" /> 
   <element name="DELIVERY_OTI" dataType="varchar2" value="DELIVERY_OTI" /> 

  </group>
  
   <group name="G_LANE_PERF_OTC_MONTH" dataType="varchar2" source="Q_LANE_PERF_OTC_MONTH">
   <element name="CONSIGnor_CITY" dataType="varchar2" value="CONSIGnor_CITY" /> 
   <element name="CONSIGnor_COUNTRY" dataType="varchar2" value="CONSIGnor_COUNTRY" /> 
   <element name="CONSIGNEE_CITY" dataType="varchar2" value="CONSIGNEE_CITY" /> 
   <element name="CONSIGNEE_COUNTRY" dataType="varchar2" value="CONSIGNEE_COUNTRY" /> 
   <element name="SERVPROV" dataType="varchar2" value="SERVPROV" /> 
   <element name="OR_COUNT" dataType="varchar2" value="OR_COUNT" /> 
   <element name="OR_WITH_RC_COUNT" dataType="varchar2" value="OR_WITH_RC_COUNT" /> 
   <element name="OTC_PERC" dataType="varchar2" value="OTC_PERC" /> 
   <element name="COLLECTION_OTI" dataType="varchar2" value="COLLECTION_OTI" /> 

 </group>
 <group name="G_LANE_PERF_OTD_MONTH" dataType="varchar2" source="Q_LANE_PERF_OTD_MONTH">
   <element name="CONSIGnor_CITY" dataType="varchar2" value="CONSIGnor_CITY" /> 
   <element name="CONSIGnor_COUNTRY" dataType="varchar2" value="CONSIGnor_COUNTRY" /> 
   <element name="CONSIGNEE_CITY" dataType="varchar2" value="CONSIGNEE_CITY" /> 
   <element name="CONSIGNEE_COUNTRY" dataType="varchar2" value="CONSIGNEE_COUNTRY" /> 
   <element name="SERVPROV" dataType="varchar2" value="SERVPROV" /> 
   <element name="OR_COUNT" dataType="varchar2" value="OR_COUNT" /> 
   <element name="OR_WITH_RC_COUNT" dataType="varchar2" value="OR_WITH_RC_COUNT" /> 
   <element name="OTD_PERC" dataType="varchar2" value="OTD_PERC" /> 
   <element name="DELIVERY_OTI" dataType="varchar2" value="DELIVERY_OTI" /> 

  </group>
  
   <group name="G_RC_DETAILS" dataType="varchar2" source="Q_RC_DETAILS">
   <element name="SH_END_MONTH" dataType="varchar2" value="SH_END_MONTH" />  
   <element name="SH_ID" dataType="varchar2" value="SH_ID" /> 
   <element name="CONSIGnor_CITY" dataType="varchar2" value="CONSIGnor_CITY" /> 
   <element name="CONSIGnor_COUNTRY" dataType="varchar2" value="CONSIGnor_COUNTRY" /> 
   <element name="CONSIGNEE_CITY" dataType="varchar2" value="CONSIGNEE_CITY" /> 
   <element name="CONSIGNEE_COUNTRY" dataType="varchar2" value="CONSIGNEE_COUNTRY" /> 
   <element name="RC_ID" dataType="varchar2" value="RC_ID" /> 
   <element name="RC_DESC" dataType="varchar2" value="RC_DESC" /> 
   <element name="RC_INSERT_USER" dataType="varchar2" value="RC_INSERT_USER" />
   <element name="CSS" dataType="varchar2" value="CSS" />
   <element name="REGION" dataType="varchar2" value="REGION" />

  </group>
  
     <group name="G_RC_FLEXIBILITY" dataType="varchar2" source="Q_RC_FLEXIBILITY">
   <element name="SH_END_MONTH" dataType="varchar2" value="SH_END_MONTH" /> 
   <element name="SH_ID" dataType="varchar2" value="SH_ID" /> 
   <element name="CONSIGNOR_CITY" dataType="varchar2" value="CONSIGNOR_CITY" />
   <element name="CONSIGNOR_COUNTRY" dataType="varchar2" value="CONSIGNOR_COUNTRY" />
   <element name="CONSIGNEE_CITY" dataType="varchar2" value="CONSIGNEE_CITY" />
   <element name="CONSIGNEE_COUNTRY" dataType="varchar2" value="CONSIGNEE_COUNTRY" />
   <element name="RC_ID" dataType="varchar2" value="RC_ID" />
   <element name="RC_DESC" dataType="varchar2" value="RC_DESC" />

  </group>
  
  <group name="G_RC_DESC" dataType="varchar2" source="Q_RC_DESC">
   <element name="GROUP_NAME" dataType="varchar2" value="GROUP_NAME" /> 
   <element name="GROUP_DESC" dataType="varchar2" value="GROUP_DESC" />
   <element name="RC" dataType="varchar2" value="RC" />
   <element name="RC_DESC" dataType="varchar2" value="RC_DESC" />


  </group>
  
  </dataStructure>
  </dataTemplate>